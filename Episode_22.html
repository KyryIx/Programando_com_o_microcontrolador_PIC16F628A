<h1 class="c95 c35" id="h.js75nxhbpdh1"><span class="c28 c87">Epis&oacute;dio 22: Conhecendo a escrita e a leitura na mem&oacute;ria EEPROM</span></h1><p class="c11 c14"><span class="c5"></span></p><p class="c11"><span class="c5">Neste episodio aprenderemos a persisitir dados no microcontrolador mesmo que a alimenta&ccedil;&atilde;o seja retirada e fazer a leitura dessas informa&ccedil;&otilde;es quando voltar a alienta&ccedil;&atilde;o.</span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11"><span class="c5">A memoria EEPROM do PIC16F628A &eacute; uma memoria de leitura e escrita e todo o processo &eacute; feito sobre os registradores EECON1, EECON2 (este registrador n&atilde;o &eacute; implementado fisicamente), EEDATA e EEADR.</span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11"><span class="c5">O PIC16F628A tem 128 bytes endere&ccedil;ados de 0x00 at&eacute; 0x7F e lidos ou escrito no registrador EEDATA de 8 bits e endere&ccedil;ados no registrador EEADR tamb&eacute;m de 8 bits, e processo de leitura e escrita na EEPROM &eacute; feita no registrador EECON1.</span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11"><span class="c5">O registrador EECON1 &eacute; exibido na Figura X1</span></p><p class="c11 c14"><span class="c5"></span></p><p class="c12"><span class="c34">Figura X1 -</span><span class="c5">Registrador EECON1</span></p><p class="c11"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 604.72px; height: 62.67px;"><img alt="" src="images/image58.png" style="width: 604.72px; height: 62.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11"><span class="c5">O bit WRERR &eacute; o bit de informa&ccedil;&atilde;o se houve erro na escrita na memoria EEPROM, onde WRERR for igual a 0, quer dizer que n&atilde;o houve erro na escrita e o processo de escrita foi completado com sucesso. Por&eacute;m, se WRERR for igual a 1, o processo de escrita na EEPROM foi terminado prematuramente e isso &eacute; um erro de escrita.</span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11"><span class="c5">O bit WREN &eacute; o bit de ativa&ccedil;&atilde;o (permiss&atilde;o) de escrita na memoria EEPROM. Quando esse bit for igual a 0, h&aacute; uma inibi&ccedil;&atilde;o de escrita de dados, enquanto se esse bit for igual a 1, h&aacute; permiss&atilde;o de escrita na EEPROM.</span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11"><span class="c5">O bit WR &eacute; o bit de controle de escrita, onde se for igual a 1, inicia o prcesso de grava&ccedil;&atilde;o na memoria EEPROM e ao final do processo esse bit &eacute; limpo (valor igual a 0), e quando WR for igual a 0 o processo de grava&ccedil;&atilde;o na EEPROM est&aacute; completo.</span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11"><span class="c5">E por &uacute;ltimo &eacute; o bit RD, onde se for igual a 1, inicia o processo de leitura de dados na EEPROM e ao final esse bit &eacute; limpo (valor igual a 0), e quando RD for igual a 0 o processo de leitura na EEPROM est&aacute; completa.</span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11"><span class="c5">Come&ccedil;aresmos com o processo de escrita na memoria EEPROM baseando no exemplo contido no datasheet no qual escrevemos o valor 0x3E (valor 62 em decimal e 00111110 em bin&aacute;rio) no endere&ccedil;o de memoria 0x01. O c&oacute;digo comentado &eacute;</span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11"><span class="c42 c8 c110">BCF  STATUS, RP1</span></p><p class="c11"><span class="c42 c8 c110">BSF  STATUS, RP0 ; seleciona banco 1</span></p><p class="c11"><span class="c42 c8 c110">MOVLW 0xO1</span></p><p class="c11"><span class="c42 c8 c110">MOVWF EEADR    ; copia o endereco para o registrador EEADR</span></p><p class="c11"><span class="c42 c8 c110">MOVLW 0x3F</span></p><p class="c11"><span class="c42 c8 c110">MOVWF EEDATA    ; copia o dado para o registrador EEDATA</span></p><p class="c11"><span class="c42 c8 c110">BSF  EECON1, WREN ; permissao para escrever</span></p><p class="c11 c14"><span class="c42 c8 c110"></span></p><p class="c11"><span class="c42 c8 c110">BCF  INTCON, GIE ; desativa todas as interrupcoes</span></p><p class="c11"><span class="c42 c8 c110">BTFSC INTCON, GIE ; verifica se a chave geral esta desligada</span></p><p class="c11"><span class="c42 c8 c110">GOTO $ - 2    ; volta 2 instrucoes</span></p><p class="c11 c14"><span class="c42 c8 c110"></span></p><p class="c11"><span class="c42 c8 c110">MOVLW 0x55     ; SEQUENCIA REQUERIDA</span></p><p class="c11"><span class="c42 c8 c110">MOVWF EECON2    ; SEQUENCIA REQUERIDA</span></p><p class="c11"><span class="c42 c8 c110">MOVLW 0xAA     ; SEQUENCIA REQUERIDA</span></p><p class="c11"><span class="c42 c8 c110">MOVWF EECON2    ; SEQUENCIA REQUERIDA</span></p><p class="c11"><span class="c42 c8 c110">BSF  EECON1, WR  ; SEQUENCIA REQUERIDA - inicia processo de escrita</span></p><p class="c11 c14"><span class="c42 c8 c110"></span></p><p class="c11"><span class="c42 c8 c110">BSF  INTCON, GIE ; ativa novamente a chave geral das interrupcoes</span></p><p class="c11 c14"><span class="c2"></span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11"><span class="c5">Agora veremos o processo de leitura da memoria EEPROM no endere&ccedil;o 0x01.</span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11"><span class="c42 c8 c110">BCF  STATUS, RP1</span></p><p class="c11"><span class="c42 c8 c110">BSF  STATUS, RP0 ; seleciona banco 1</span></p><p class="c11"><span class="c42 c8 c110">MOVLW 0xO1</span></p><p class="c11"><span class="c42 c8 c110">MOVWF EEADR    ; copia o endereco para o registrador EEADR</span></p><p class="c11"><span class="c42 c8 c110">BSF  EECON1, RD  ; inicia processo de leitura</span></p><p class="c11"><span class="c42 c8 c110">MOVF EEDATA, 0  ; copia o conteudo lido da EEPROM para o registrador W</span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11"><span class="c5">No caso de escrita na memoria EEPROM, h&aacute; dois bits que podem ser usados para verificar o estado do pr9cesso. O primeiro bit que pode ser usado &eacute; o bit WRERR como visto anteriormente se for igual a 1, houve erro na escrita, 0 caso o contrario. O outro bit est&aacute; relacionado a interrup&ccedil;&atilde;o de escrita na memoria EEPROM, sendo o bit EEIF do registrador PIR1, no qual se for igual a 0, a opera&ccedil;&atilde;o de escrita n&atilde;o foi completada ou n&atilde;o foi iniciada, mas se for igual a 1, a opera&ccedil;&atilde;o de escrita foi completada com sucesso e esse bit tem que ser limpo ap&oacute;s tratamento.</span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11"><span class="c5">Exemplo completo de contagem de objetos, mesmo ap&oacute;s desligar a maquina de contagem.</span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11 c14"><span class="c5"></span></p><hr style="page-break-before:always;display:none;">