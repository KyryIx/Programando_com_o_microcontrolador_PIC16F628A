<h1 class="c75 c35" id="h.289guchjb9jj"><span class="c28 c87"></span></h1><h1 class="c95 c35" id="h.l9hau6hf265b"><span class="c28 c87">Epis&oacute;dio 21: Conhecendo o m&oacute;dulo de tens&atilde;o el&eacute;trica de refer&ecirc;ncia</span></h1><p class="c11 c14"><span class="c5"></span></p><p class="c11"><span class="c5">Neste episodio veremos como usar o PIC16F628A para gerar tens&atilde;o eletrica variavel no pino RA2.</span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11"><span class="c5">O modulo de tensao eletrica de referencia&eacute; controlado pelo registrador VRCON (Voltage Reference Control Register) o qual pode ser visto na Figura X1.</span></p><p class="c11 c14"><span class="c5"></span></p><p class="c12"><span class="c34">Figura X1 -</span><span class="c5">Registrador VRCON</span></p><p class="c11"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 604.72px; height: 66.67px;"><img alt="" src="images/image49.png" style="width: 604.72px; height: 66.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11"><span class="c5">O controle do estado do modulo de tens&atilde;o eletrica de referencia s&atilde;o dados pelos bits VREN e VROE, onde</span></p><ul class="c80 lst-kix_t3aisgctvec8-0 start"><li class="c31"><span class="c5">VREN &eacute; igual a 1 se quer ligar o m&oacute;dulo de tens&atilde;o el&eacute;trica de referencia ou igual a 0 para desligar o modulo;</span></li><li class="c31"><span class="c5">VROE &eacute; o bit reponsavel por ativar (valor igual a 1) ou n&atilde;o (valor igual a 1) a saida no pino RA2.</span></li></ul><p class="c11 c49 c14"><span class="c5"></span></p><p class="c11"><span class="c5">Para a configura&ccedil;&atilde;o do valor da amplitude da tens&atilde;o el&eacute;trica no pino RA2, h&aacute; dois intervalos de trabalho, conhecido como &ldquo;intervalo baixo&rdquo; e &ldquo;intervalo alto&rdquo;.</span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11"><span class="c5">A escolha pelo &ldquo;intervalo baixo&rdquo; se d&aacute; limpando (valor igual a 0) o bit VRR do registrador VRCON, enquanto a escolha pelo &rdquo;intervalo alto&rdquo; se d&aacute; setando (valor 1) o bit VRR do registrador VRCON.</span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11"><span class="c5">A base para o c&aacute;lculo do valor da tens&atilde;o el&eacute;trica &eacute; dada pelos valores setados (valores 1) ou limpos (valores 0) dos bits VR&lt;3:0&gt; e pelas equa&ccedil;&otilde;es</span></p><ul class="c80 lst-kix_36t8x2wn9cy1-0 start"><li class="c31"><span class="c5">intervalo baixo (VRR = 0)</span></li></ul><p class="c12 c49"><span class="c5">VREF = (VDD/4) + (VR&lt;3:0&gt; / 32) * VDD</span></p><ul class="c80 lst-kix_36t8x2wn9cy1-0"><li class="c31"><span class="c5">intervalo alto (VRR = 1)</span></li></ul><p class="c12 c49"><span class="c5">VREF = (VR&lt;3:0&gt; / 24) * VDD</span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11"><span class="c5">onde 0 &le; VR&lt;3:0&gt; &le; 15 (16 valores possiveis por intervalo).</span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11"><span class="c5">A Figura X2 exibe o funcionamento do modulo e o valor de R &eacute; aproximadamente 2k&#x1d6fa;. </span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11 c14"><span class="c5"></span></p><p class="c12"><span class="c34">Figura X2 -</span><span class="c5">Diagrama de bloco do modulo de referencia de tens&atilde;o eletrica</span></p><p class="c11"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 604.72px; height: 180.00px;"><img alt="" src="images/image35.png" style="width: 604.72px; height: 180.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11"><span class="c5">Os limites de tens&atilde;o de cada intevalo s&atilde;o, baseando-se em VDD = 5,0 V</span></p><p class="c11 c14"><span class="c5"></span></p><ul class="c80 lst-kix_kxspdncckzkc-0 start"><li class="c31"><span class="c5">intervalo baixo (VRR = 0)</span></li></ul><p class="c11 c49 c14"><span class="c5"></span></p><p class="c11 c49"><span class="c34">VR&lt;3:0&gt; = 000</span><span class="c34 c62">2</span><span class="c34">= 0</span><span class="c63 c34 c62 c50 c53">10</span></p><p class="c11 c49"><span class="c26">VDD = 5 V</span></p><p class="c11 c49 c14"><span class="c5"></span></p><p class="c24 c49"><span class="c5">VREF = (VDD/4) + (VR&lt;3:0&gt; / 32) * VDD</span></p><p class="c24 c49"><span class="c5">VREF = (5 V/4) + (0 / 32) * 5 V</span></p><p class="c24 c49"><span class="c5">VREF = 1,25 V + 0 * 5 V</span></p><p class="c24 c49"><span class="c5">VREF = 1,25 V</span></p><p class="c24 c49 c14"><span class="c5"></span></p><p class="c11 c49"><span class="c34">VR&lt;3:0&gt; = 111</span><span class="c34 c62">2</span><span class="c34">= 15</span><span class="c63 c34 c62 c50 c53">10</span></p><p class="c11 c49"><span class="c26">VDD = 5 V</span></p><p class="c24 c49 c14"><span class="c5"></span></p><p class="c24 c49"><span class="c5">VREF = (VDD/4) + (VR&lt;3:0&gt; / 32) * VDD</span></p><p class="c24 c49"><span class="c5">VREF = (5 V/4) + (15 / 32) * 5 V</span></p><p class="c24 c49"><span class="c5">VREF = 1,25 V + 0,46875 * 5 V</span></p><p class="c24 c49"><span class="c5">VREF = 3,594 V</span></p><p class="c24 c49 c14"><span class="c5"></span></p><p class="c24 c49"><span class="c5">Assim para 0 &le; VR&lt;3:0&gt; &le; 15 implica que 1,25 V &le; VREF &le; 3,594 V</span></p><p class="c11 c49 c14"><span class="c5"></span></p><ul class="c80 lst-kix_kxspdncckzkc-0"><li class="c31"><span class="c5">intevalo alto (VRR = 1)</span></li></ul><p class="c11 c49 c14"><span class="c5"></span></p><p class="c11 c49"><span class="c34">VR&lt;3:0&gt; = 000</span><span class="c34 c62">2</span><span class="c34">= 0</span><span class="c63 c34 c62 c50 c53">10</span></p><p class="c11 c49"><span class="c26">VDD = 5 V</span></p><p class="c11 c49 c14"><span class="c5"></span></p><p class="c24 c49"><span class="c5">VREF = (VR&lt;3:0&gt; / 24) * VDD</span></p><p class="c24 c49"><span class="c5">VREF = (0 / 24) * 5 V</span></p><p class="c24 c49"><span class="c5">VREF = 0 V</span></p><p class="c24 c49 c14"><span class="c5"></span></p><p class="c11 c49"><span class="c34">VR&lt;3:0&gt; = 111</span><span class="c34 c62">2</span><span class="c34">= 15</span><span class="c63 c34 c62 c50 c53">10</span></p><p class="c11 c49"><span class="c34">VDD = 5 V</span></p><p class="c24 c49 c14"><span class="c5"></span></p><p class="c24 c49"><span class="c5">VREF = (VR&lt;3:0&gt; / 24) * VDD</span></p><p class="c24 c49"><span class="c5">VREF = (15 / 24) * 5 V</span></p><p class="c24 c49"><span class="c5">VREF = 0,625 * 5 V</span></p><p class="c24 c49"><span class="c5">VREF = 3,125 V</span></p><p class="c24 c49 c14"><span class="c5"></span></p><p class="c24 c49"><span class="c5">Assim para 0 &le; VR&lt;3:0&gt; &le; 15 implica que 0 V &le; VREF &le; 3,125 V</span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11"><span class="c5">Veja a Tabela X1 com o valores aproximados possiveis para a tens&atilde;o de referencia</span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11"><span class="c5">Tabela X1 - Valores de tens&atilde;o de referencia</span></p><a id="t.d58f7656225445d9314a1f846897f6c94820b44c"></a><a id="t.159"></a><table class="c56"><tbody><tr class="c101"><td class="c165"><p class="c71 c14"><span class="c26"></span></p></td><td class="c239" colspan="2" rowspan="1"><p class="c71"><span class="c26">VREF (volts)</span></p></td></tr><tr class="c101"><td class="c165"><p class="c71"><span class="c34">VR&lt;3:0&gt;</span></p></td><td class="c92"><p class="c71"><span class="c34">intervalo baixo</span></p></td><td class="c86"><p class="c71"><span class="c34">intervalo alto</span></p></td></tr><tr class="c101"><td class="c165"><p class="c71"><span class="c5">0</span></p></td><td class="c92"><p class="c71"><span class="c5">1,2500</span></p></td><td class="c86"><p class="c71"><span class="c5">0,0000</span></p></td></tr><tr class="c101"><td class="c165"><p class="c71"><span class="c5">1</span></p></td><td class="c92"><p class="c71"><span class="c5">1,4063</span></p></td><td class="c86"><p class="c71"><span class="c5">0,2083</span></p></td></tr><tr class="c101"><td class="c165"><p class="c71"><span class="c5">2</span></p></td><td class="c92"><p class="c71"><span class="c5">1,5625</span></p></td><td class="c86"><p class="c71"><span class="c5">0,4167</span></p></td></tr><tr class="c101"><td class="c165"><p class="c71"><span class="c5">3</span></p></td><td class="c92"><p class="c71"><span class="c5">1,7188</span></p></td><td class="c86"><p class="c71"><span class="c5">0,6250</span></p></td></tr><tr class="c101"><td class="c165"><p class="c71"><span class="c5">4</span></p></td><td class="c92"><p class="c71"><span class="c5">1,8750</span></p></td><td class="c86"><p class="c71"><span class="c5">0,8333</span></p></td></tr><tr class="c101"><td class="c165"><p class="c71"><span class="c5">5</span></p></td><td class="c92"><p class="c71"><span class="c5">2,0313</span></p></td><td class="c86"><p class="c71"><span class="c5">1,0417</span></p></td></tr><tr class="c101"><td class="c165"><p class="c71"><span class="c5">6</span></p></td><td class="c92"><p class="c71"><span class="c5">2,1875</span></p></td><td class="c86"><p class="c71"><span class="c5">1,2500</span></p></td></tr><tr class="c101"><td class="c165"><p class="c71"><span class="c5">7</span></p></td><td class="c92"><p class="c71"><span class="c5">2,3438</span></p></td><td class="c86"><p class="c71"><span class="c5">1,4583</span></p></td></tr><tr class="c101"><td class="c165"><p class="c71"><span class="c5">8</span></p></td><td class="c92"><p class="c71"><span class="c5">2,5000</span></p></td><td class="c86"><p class="c71"><span class="c5">1,6667</span></p></td></tr><tr class="c101"><td class="c165"><p class="c71"><span class="c5">9</span></p></td><td class="c92"><p class="c71"><span class="c5">2,6563</span></p></td><td class="c86"><p class="c71"><span class="c5">1,8750</span></p></td></tr><tr class="c101"><td class="c165"><p class="c71"><span class="c5">10</span></p></td><td class="c92"><p class="c71"><span class="c5">2,8125</span></p></td><td class="c86"><p class="c71"><span class="c5">2,0833</span></p></td></tr><tr class="c101"><td class="c165"><p class="c71"><span class="c5">11</span></p></td><td class="c92"><p class="c71"><span class="c5">2,9688</span></p></td><td class="c86"><p class="c71"><span class="c5">2,2917</span></p></td></tr><tr class="c101"><td class="c165"><p class="c71"><span class="c5">12</span></p></td><td class="c92"><p class="c71"><span class="c5">3,1250</span></p></td><td class="c86"><p class="c71"><span class="c5">2,5000</span></p></td></tr><tr class="c101"><td class="c165"><p class="c71"><span class="c5">13</span></p></td><td class="c92"><p class="c71"><span class="c5">3,2813</span></p></td><td class="c86"><p class="c71"><span class="c5">2,7083</span></p></td></tr><tr class="c101"><td class="c165"><p class="c71"><span class="c5">14</span></p></td><td class="c92"><p class="c71"><span class="c5">3,4375</span></p></td><td class="c86"><p class="c71"><span class="c5">2,9167</span></p></td></tr><tr class="c101"><td class="c165"><p class="c71"><span class="c5">15</span></p></td><td class="c92"><p class="c71"><span class="c5">3,5938</span></p></td><td class="c86"><p class="c71"><span class="c5">3,1250</span></p></td></tr></tbody></table><p class="c11 c14"><span class="c5"></span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11"><span class="c5">Aqui vejamos um exemplo de codigo para gerar a tens&atilde;o de referencia baseado no exemplo do datasheet. Neste exemplo a tens&atilde;o de referencia ser&aacute; usada para alimentar o modulo comparador e ter tomadas de decis&otilde;es baseadas em niveis de tens&atilde;o ajustadas internamente. A Figura X3 mostra a modo do modulo comparador que usaremos neste exemplo, onde a tens&atilde;o que ser&aacute; usada na porta n&atilde;o-inversora dos comparadores de tens&atilde;o C1 e C2 vir&aacute; do modulo de refencia de tens&atilde;o.</span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11"><span class="c34">Figura X3 -</span><span class="c5">Modo de quatro entradas multiplexadas para dois comparadores e tens&atilde;o de refencia</span></p><p class="c11"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 456.00px; height: 222.00px;"><img alt="" src="images/image46.png" style="width: 456.00px; height: 222.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11"><span class="c26">Exemplo:</span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11"><span class="c2">MOVLW 0x02    ; 02(16)=0000.0010 =&gt; CM2.CM1.CM0 = 0.1.0</span></p><p class="c11"><span class="c8">MOVWF CMCON    ; </span><span>4 entradas multiplexadas 2 comparadores e tensao de referencia</span></p><p class="c11 c14"><span class="c2"></span></p><p class="c11"><span class="c2">BSF  STATUS, RP0 ; seleciona o banco 1</span></p><p class="c11 c14"><span class="c2"></span></p><p class="c11"><span class="c2">MOVLW 0x07    ; 07(16)=1111.1111(2)</span></p><p class="c11"><span class="c2">MOVWF TRISA    ; RA7~RA0 are entradas</span></p><p class="c11 c14"><span class="c2"></span></p><p class="c11"><span class="c2">MOVLW 0xA6    ; A6(16)=1010.0110(2) =&gt; VREN=1,VROE=0,VRR=1(int. baixo)</span></p><p class="c11"><span class="c2">MOVWF VRCON    ; VR3.VR2.VR1.VR0 = 0110(2) = 6 </span></p><p class="c11 c14"><span class="c2"></span></p><p class="c11"><span class="c2">BCF  STATUS, RP0 ; seleciona o banco 0</span></p><p class="c11"><span class="c2">CALL DELAY10   ; chama uma rotina chamada DELAY10</span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11 c14"><span class="c5"></span></p>