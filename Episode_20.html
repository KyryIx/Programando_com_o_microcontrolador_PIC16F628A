<h1 class="c75 c35" id="h.y1ta83frhrx6"><span class="c28 c87"></span></h1><h1 class="c95 c35" id="h.m305xgcjv6z5"><span class="c28 c87">Epis&oacute;dio 20: Conhecendo o m&oacute;dulo Comparador e a interrup&ccedil;&atilde;o associada</span></h1><p class="c11 c14"><span class="c5"></span></p><p class="c11"><span class="c5">Neste episodio veremos o uso de 2 comparadores que compoem o modulo comparador, al&eacute;m de poder fazer uso de interrup&ccedil;&atilde;o associada a esse modulo.</span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11"><span class="c5">Nos episodios anteriores, para podermos fazer uso dos exemplos, sempre foi feita o desligamento do mudulo comparador.</span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11"><span class="c5">A configura&ccedil;&atilde;o do modulo comparador &eacute; feita pelo registrador CMCON (Comparator Configurator Register) enquanto os registradores INTCON (GIE e PEIE), PIE1 (CMIE), PIR1 (CMIF) e TRISA (TRISA&lt;3:0&gt;).</span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11"><span class="c5">O registrador CMCON &eacute; visualizado na Figura X1</span></p><p class="c11 c14"><span class="c5"></span></p><p class="c12"><span class="c34">Figura X1 -</span><span class="c5">Registrador CMCON</span></p><p class="c11"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 604.72px; height: 65.33px;"><img alt="" src="images/image39.png" style="width: 604.72px; height: 65.33px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11"><span class="c5">e os comparadores s&atilde;o conforme a Figura X2</span></p><p class="c11 c14"><span class="c5"></span></p><p class="c12"><span class="c34">Figura X2 -</span><span class="c5">Comparador e seu funcionamento</span></p><p class="c12"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 377.11px; height: 318.39px;"><img alt="" src="images/image43.png" style="width: 377.11px; height: 318.39px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11"><span class="c5">Os bits de configura&ccedil;&atilde;o dos modos de trabalho possiveis s&atilde;o exibidos na Tabela X1</span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11 c14"><span class="c5"></span></p><p class="c12"><span class="c34">Tabela X1 -</span><span class="c5">Modos de opera&ccedil;&atilde;o do modulo comparador</span></p><a id="t.219995c084533e9a3cbd686ed3e67b784721a007"></a><a id="t.158"></a><table class="c56"><tbody><tr class="c21"><td class="c111"><p class="c1"><span class="c26">CM2</span></p></td><td class="c111"><p class="c1"><span class="c26">CM1</span></p></td><td class="c111"><p class="c1"><span class="c26">CM0</span></p></td><td class="c29"><p class="c1"><span class="c26">Modo</td>
</tr>
<tr class="c21"><td class="c111"><p class="c1"><span class="c5">0</span></p></td><td class="c111"><p class="c1"><span class="c5">0</span></p></td><td class="c111"><p class="c1"><span class="c5">0</span></p></td><td class="c29"><p class="c19"><span class="c5">Comparadores em reset</td>
</tr>
<tr class="c21"><td class="c111"><p class="c1"><span class="c5">0</span></p></td><td class="c111"><p class="c1"><span class="c5">0</span></p></td><td class="c111"><p class="c1"><span class="c5">1</span></p></td><td class="c29"><p class="c19"><span class="c5">Tr&ecirc;s entradas multiplexadas para dois comparadores</td>
</tr>
<tr class="c21"><td class="c111"><p class="c1"><span class="c5">0</span></p></td><td class="c111"><p class="c1"><span class="c5">1</span></p></td><td class="c111"><p class="c1"><span class="c5">0</span></p></td><td class="c29"><p class="c19"><span class="c5">Quatro entradas multiplexadas para dois comparadores</td>
</tr>
<tr class="c21"><td class="c111"><p class="c1"><span class="c5">0</span></p></td><td class="c111"><p class="c1"><span class="c5">1</span></p></td><td class="c111"><p class="c1"><span class="c5">1</span></p></td><td class="c29"><p class="c19"><span class="c5">Dois comparadores referencia comum</td>
</tr>
<tr class="c21"><td class="c111"><p class="c1"><span class="c5">1</span></p></td><td class="c111"><p class="c1"><span class="c5">0</span></p></td><td class="c111"><p class="c1"><span class="c5">0</span></p></td><td class="c29"><p class="c19"><span class="c5">Dois comparadores independentes</td>
</tr>
<tr class="c21"><td class="c111"><p class="c1"><span class="c5">1</span></p></td><td class="c111"><p class="c1"><span class="c5">0</span></p></td><td class="c111"><p class="c1"><span class="c5">1</span></p></td><td class="c29"><p class="c19"><span class="c5">Um comparador independente</td>
</tr>
<tr class="c21"><td class="c111"><p class="c1"><span class="c5">1</span></p></td><td class="c111"><p class="c1"><span class="c5">1</span></p></td><td class="c111"><p class="c1"><span class="c5">0</span></p></td><td class="c29"><p class="c19"><span class="c5">Dois comparadores referencia comum com saidas</td>
</tr>
<tr class="c21"><td class="c111"><p class="c1"><span class="c5">1</span></p></td><td class="c111"><p class="c1"><span class="c5">1</span></p></td><td class="c111"><p class="c1"><span class="c5">1</span></p></td><td class="c29"><p class="c19"><span class="c5">Comparadores desligados</span></p></td></tr></tbody></table><p class="c11 c14"><span class="c5"></span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11"><span class="c5">Neste momento falaremos dos bits C1OUT, C2OUT, C1INV e C2INV do registrador CMCON pois s&atilde;o fundamentais para a leitura dos estados processados pelos comparadores.</span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11"><span class="c5">Os bits C1OUT (C2OUT) &eacute; o bit repons&aacute;vel por armazenar o estado da sa&iacute;da do comparador C1 (C2). J&aacute; o bit C1INV (C2INV) &eacute; o bit com a fun&ccedil;&atilde;o de inverter o valor da sa&iacute;da em C1OUT (C2OUT).</span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11"><span class="c34">Exemplo:</span><span class="c5">Se a porta n&atilde;o-inversora (VIN+) do comparador 1 (C1) tiver uma tens&atilde;o eletrica aplicada nela de 3,3 V e na porta inversora (VIN-) tiver uma tens&atilde;o eletrica de 1,2 V aplicada, a sa&iacute;da C1OUT do comparador C1 ficar&aacute; em nivel alto - valor 1 se o valor do bit C1INV for igual a 0, por&eacute;m se C1INV for igual a 1 para as mesmas condi&ccedil;&otilde;es (VIN+ = 3,3 V e VIN- = 1,2 V) a sa&iacute;da C1OUT ficar&aacute; em n&iacute;vel baixo - valor 0.</span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11"><span class="c5">O primeiro modo de trabalho do modulo comparador &eacute; o modo de reset quando CM&lt;2:0&gt; conforme Figura X1. Neste modo as saidas est&atilde;o em nivel baixo, isto &eacute;, as saidas dos comparadores C1 e C2 tem seus valores zero nos bits C1OUT e c2OUT de CMCON quando os bits C1INV e C2INV s&atilde;o iguais a 0 e os pinos estar&atilde;o trabalhando como pinos analogicos.</span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11 c14"><span class="c5"></span></p><p class="c12"><span class="c34">Figura X1 -</span><span class="c5">Modo reset do modulo comparador</span></p><p class="c11"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 604.72px; height: 244.00px;"><img alt="" src="images/image72.png" style="width: 604.72px; height: 244.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11"><span class="c5">O segundo modo &eacute; quando CM&lt;2:0&gt; = 111, no qual os comparadores est&atilde;o desligados e os pinos RA0 e RA3 est&atilde;o trabalhando como pinos digitais e as sa&iacute;das e entradas dos comparadores est&atilde;o em nivel baixo conforme Figura X2.</span></p><p class="c11 c14"><span class="c5"></span></p><p class="c12"><span class="c34">Figura X2 -</span><span class="c5">Modo desligado do modulo comparador</span></p><p class="c11"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 596.00px; height: 256.00px;"><img alt="" src="images/image36.png" style="width: 596.00px; height: 256.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11"><span class="c5">Vejamos o caso onde h&aacute; necessidade de trabalhar com duas entradas multiplixedas conforme Figura X3 (CM&lt;2:0&gt; = 001) e Figura X4 (CM&lt;2:0&gt; = 010).</span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11 c14"><span class="c5"></span></p><p class="c12"><span class="c34">Figura X3 -</span><span class="c5">Tr&ecirc;s entradas multiplexadas para dois comparadores</span></p><p class="c12"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 446.89px; height: 180.40px;"><img alt="" src="images/image68.png" style="width: 446.89px; height: 180.40px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c11 c14"><span class="c5"></span></p><p class="c12"><span class="c34">Figura X4 -</span><span>Quatro entradas multiplexadas para dois comparadores</span></p><p class="c12"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 458.00px; height: 224.00px;"><img alt="" src="images/image59.png" style="width: 458.00px; height: 224.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11"><span class="c5">Na Figura X3 est&aacute; sendo usado o modo de tr&ecirc;s entradas multiplexadas CM&lt;2:0&gt; = 001, no qual os pinos RA0 e RA3 ser&atilde;o mupliplexadas, no qual esse controle &eacute; feito pelo bit CIS do registrador CMCON. Assim, se o bit CIS for igual a 0, o pino RA0 ser&aacute; conectador internamente a porta inversora do comparador 1, mas caso CIS for igual a 1, ser&aacute; o pino RA3 conectado internamente a porta inversora do comparador 1.</span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11"><span>Existem outros modos e voc&ecirc; pode ve-los no datasheet do disposito no </span><span class="c39">[colocar link]</span><span class="c5">na p&aacute;gina 64.</span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11"><span class="c5">Agora veremos um exemplo para monitorar temperatura por limite inferior e superior dado um sensor de temperatura LM35 com saida analogica e por dois potenciometros usados para em dois divisores de tens&otilde;a. conforme Figura X5 e fazendo uso do modo de dois comparadores referencia comum (CM&lt;2:0&gt; = 011)</span></p><p class="c11 c14"><span class="c5"></span></p><p class="c12"><span class="c34">Figura X5 -</span><span class="c5">Esquema eletrico do exemplo</span></p><p class="c12"><span class="c42 c39 c34 c50">COLOCAR AQUI O CIRCUITO ELETRONICO</span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11"><span class="c5">A regra &eacute; que quando a tens&atilde;o nos pinos RA2/RA3 (portas n&atilde;o-inversora):</span></p><ul class="c80 lst-kix_4fdctnvv1za8-0 start"><li class="c31"><span class="c5">for menor que a tens&atilde;o no pino RA0 (porta inversora do comparador C1) ativar o pino RB4, sen&atilde;o desativa RB4;</span></li><li class="c31"><span class="c5">for maior que a tens&atilde;o no pino RA1 (porta inversora do comparador C2) ativa o pino RB5, sen&atilde;o desativa RB5.</span></li></ul><p class="c11 c14"><span class="c5"></span></p><p class="c11"><span class="c5">A solu&ccedil;&atilde;o &eacute; dada pelo segunte c&acute;dogio:</span></p><p class="c12"><span class="c39 c34">COLOCAR AQUI O CIRCUITO ELETRONICO</span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11"><span class="c5">Veremos agora como utilizar a interrup&ccedil;&atilde;o associada a esse modulo.</span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11"><span class="c5">A interrup&ccedil;&atilde;o sobre o modulo comparador ocorre quando h&aacute; uma troca de estados nos bits C1OUT ou C2OUT.</span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11"><span class="c5">O primeiro bit a ser configurado (setados) &eacute; bit CMIE do registrador PIE1, ap&oacute;s o bit PEIE do registrador INTCON deve ser setado, a interrup&ccedil;&atilde;o j&aacute; estar&aacute; em funcionamento e o bit do registrador PIR1 tem o estado da interrup&ccedil;&atilde;o.</span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11"><span class="c39 c34">Nota:</span><span class="c42 c39 c50 c44">If a change in the CMCON register (C1OUT or C2OUT) should occur when a read operation is being executed (start of the Q2 cycle), then the CMIF (PIR1&lt;6&gt;) interrupt flag may not get set.</span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11"><span class="c5">Exemplo: Modifica&ccedil;&atilde;o do exemplo __ aplicando o uso de interrup&ccedil;&atilde;o.</span></p><p class="c24 c14"><span class="c5"></span></p><p class="c24 c14"><span class="c5"></span></p><hr style="page-break-before:always;display:none;">