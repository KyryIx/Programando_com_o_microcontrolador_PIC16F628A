<h1 class="c75 c35" id="h.snkkl4wfcx4q"><span class="c28 c87"></span></h1><h1 class="c95 c35" id="h.wqzrj958isdh"><span class="c28 c87">Epis&oacute;dio 12: Conhecendo a interrup&ccedil;&atilde;o externa em RB0 e a instru&ccedil;&atilde;o RETFIE no PIC16F628A</span></h1><p class="c11 c14"><span class="c5"></span></p><p class="c11"><span class="c5">Em algumas aplica&ccedil;&otilde;es onde h&aacute; a necessidade de tomada de uma a&ccedil;&atilde;o de forma instant&acirc;nea, como por exemplo, uma prensa que n&atilde;o pode pressionar a m&atilde;o do utilizador, no qual existir&aacute; um sensor de barreira que enviar&aacute; um sinal ao microcontrolador dizendo que h&aacute; um objeto/m&atilde;o que poder&aacute; sofrer danos.</span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11"><span>No microcontrolador PIC16F628A existe a interrup&ccedil;&atilde;o que pode ser usada para este processo, e ela &eacute; conhecida por &ldquo;interrup&ccedil;&atilde;o externa&rdquo; associada a pino </span><span class="c47 c34">RB0</span><span>do registrador </span><span class="c47 c34 c37">PORTB</span><span class="c5">e para trabalhar com a interrup&ccedil;&atilde;o externa h&aacute; a necessidade de configura&ccedil;&atilde;o de alguns bits de registradores.</span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11"><span>O primeiro registrador a ser configurado ser&aacute; o registrador </span><span class="c47 c34 c37">OPTION_REG</span><span class="c5">pois com ele se escolhe o tipo de borda (subida ou descida) que aciona a interrup&ccedil;&atilde;o.</span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11"><span>No registrador </span><span class="c47 c34 c37">OPTION_REG</span><span>, o bit </span><span class="c47 c34">INTEDG</span><span class="c5">quando setado (valor igual a 1) seleciona a interrup&ccedil;&atilde;o por borda de subida, enquanto que esse bit estiver limpo (valor igual a 0), seleciona a interrup&ccedil;&atilde;o por borda de descida.</span></p><p class="c11 c14"><span class="c5"></span></p><p class="c12"><span class="c34">Figura 12.1 - </span><span class="c5">Visualiza&ccedil;&atilde;o de borda de subida e descida em um sinal</span></p><a id="t.3c9232b2d5d9ea2a259f8403ad80b64e9db35916"></a><a id="t.134"></a><table class="c7"><tbody><tr class="c21"><td class="c231"><p class="c12"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 359.39px; height: 73.84px;"><img alt="" src="images/image15.png" style="width: 359.39px; height: 73.84px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td></tr></tbody></table><p class="c24"><span>             </span><span class="c42 c39 c50 c44">Fonte: Pr&oacute;prio autor (2020)</span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11"><span>Outro registrador a ser configurado &eacute; o registrador </span><span class="c47 c34 c37">INTCON</span><span>em rela&ccedil;&atilde;o aos</span><span>bits </span><span class="c47 c34">INTE</span><span>(flag de ativa&ccedil;&atilde;o da interrup&ccedil;&atilde;o externa), </span><span class="c47 c34">INTF</span><span>(flag de estado se houve ou n&atilde;o a ocorr&ecirc;ncia da interrup&ccedil;&atilde;o externa) e </span><span class="c47 c34">GIE</span><span class="c5">(flag da chave geral de todas as interrup&ccedil;&otilde;es) s&atilde;o os bits importantes para esta interrup&ccedil;&atilde;o.</span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11"><span>O bit </span><span class="c47 c34">INTE</span><span>&eacute; respons&aacute;vel por ativar se setado (valor igual 1) ou desativar se limpo (valor igual a 0) exclusivamente a interrup&ccedil;&atilde;o externa, enquanto que o bit </span><span class="c47 c34">GIE</span><span class="c5">&eacute; respons&aacute;vel por permitir se setado (valor igual a 1) ou n&atilde;o permitir se limpo (valor igual a 0) todas as interrup&ccedil;&otilde;es, conforme a Figura 12.2.</span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11"><span>J&aacute; o bit </span><span class="c47 c34">INTF</span><span>&eacute; respons&aacute;vel por informar se houve ou n&atilde;o a ocorr&ecirc;ncia da interrup&ccedil;&atilde;o externa, e isto ocorre, verificando seu valor. Se o bit/flag </span><span class="c47 c34">INTF</span><span class="c5">estiver setado (valor 1), quer dizer que houve a ocorr&ecirc;ncia da interrup&ccedil;&atilde;o externa, e caso esteja limpo (valor 0), n&atilde;o houve a ocorr&ecirc;ncia da interrup&ccedil;&atilde;o externa.</span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11 c14"><span class="c26"></span></p><a id="t.adf84df8f13e100f53f0786c87332695cc0f32e2"></a><a id="t.135"></a><table class="c56"><tbody><tr class="c21"><td class="c68"><p class="c11"><span class="c115 c34">OBSERVA&Ccedil;&Atilde;O:</span><span class="c5">Os bits terminados em:</span></p><ul class="c80 lst-kix_kyig0s488g25-0 start"><li class="c31"><span class="c34">E</span><span>s&atilde;o bits de </span><span class="c37">Enable</span><span class="c5">(ativar/ativa&ccedil;&atilde;o) utilizados para ativar uma certa a&ccedil;&atilde;o/propriedade no microcontrolador;</span></li><li class="c31"><span class="c34">F</span><span>s&atilde;o bits de </span><span class="c37">Flag</span><span>(bandeira) utilizados para informar se houve ocorr&ecirc;ncia de alguma a&ccedil;&atilde;o/propriedade ativada pelo bit terminado com </span><span class="c34">E</span><span>.</span></li></ul></td></tr></tbody></table><p class="c11 c14"><span class="c26"></span></p><p class="c11"><span>Todo o tratamento de interrup&ccedil;&atilde;o &eacute; feito no endere&ccedil;o </span><span class="c8">0x04</span><span>para o PIC16F628A</span><span class="c39"></span><span>e &eacute; retornado &agrave; rotina principal pela instru&ccedil;&atilde;o </span><span class="c38 c34">RETFIE</span><span class="c5">.</span></p><p class="c11 c14"><span class="c5"></span></p><p class="c12"><span class="c34">Figura 12.2 -</span><span class="c5">Bits associados &agrave;s interrup&ccedil;&otilde;es no PIC16F628A</span></p><a id="t.3c9232b2d5d9ea2a259f8403ad80b64e9db35916"></a><a id="t.136"></a><table class="c7"><tbody><tr class="c21"><td class="c68"><p class="c11"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 590.00px; height: 193.33px;"><img alt="" src="images/image47.png" style="width: 590.00px; height: 193.33px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td></tr></tbody></table><p class="c24"><span class="c42 c39 c50 c44">Fonte: MICROCHIP 2020 (b) p&aacute;gina 109</span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11"><span class="c5">Vejamos agora um exemplo para exemplificar o uso da interrp&ccedil;&atilde;o externa no PIC16F628A abordado em sistemas de seguran&ccedil;a, conforme Figura 12.3 e Figura 12.4.</span></p><p class="c11 c14"><span class="c5"></span></p><p class="c12"><span class="c34">Figura 12.3 -</span><span class="c5">Sistema de seguran&ccedil;a com bot&atilde;o de emerg&ecirc;ncia</span></p><a id="t.3c9232b2d5d9ea2a259f8403ad80b64e9db35916"></a><a id="t.137"></a><table class="c7"><tbody><tr class="c21"><td class="c220"><p class="c1"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 393.00px; height: 205.33px;"><img alt="" src="images/image71.jpg" style="width: 393.00px; height: 205.33px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td></tr></tbody></table><p class="c24"><span>            </span><span class="c39">Fonte: </span><span class="c39 c59"><a href="https://www.google.com/url?q=http://www.serralheriasjcampinas.com.br/laudo-tecnico-nr-12/&amp;sa=D&amp;source=editors&amp;ust=1619797899794000&amp;usg=AOvVaw2oTabPZkA5yCCFhWLgMIZF">http://www.serralheriasjcampinas.com.br/laudo-tecnico-nr-12/</a></span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11 c14"><span class="c5"></span></p><p class="c11 c14"><span class="c5"></span></p><p class="c12"><span class="c34">Figura 12.4 - </span><span class="c0">Bot&atilde;o Cogumelo Vermelho com Trava Metaltex P20AKR-R-1B</span></p><a id="t.3c9232b2d5d9ea2a259f8403ad80b64e9db35916"></a><a id="t.138"></a><table class="c7"><tbody><tr class="c21"><td class="c177"><p class="c1"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 278.21px; height: 239.53px;"><img alt="" src="images/image9.jpg" style="width: 278.21px; height: 239.53px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td></tr></tbody></table><p class="c24"><span class="c6 c39 c163 c44">Fonte: </span><span class="c59 c6 c39 c163 c44"><a href="https://www.google.com/url?q=https://www.metaltex.com.br/produtos/automacao/comando/p20-botao-de-comando-plastico-22mm&amp;sa=D&amp;source=editors&amp;ust=1619797899795000&amp;usg=AOvVaw0pGzk42xbiUoR9I9nf-7M2">https://www.metaltex.com.br/produtos/automacao/comando/p20-botao-de-comando-plastico-22mm</a></span></p><p class="c11 c14"><span class="c5"></span></p><p class="c67 c35"><span class="c6 c163 c44">Na Figura 12.5 pode-se ver o circuito projetado no simulador </span><span class="c6 c163 c37 c44">SimulIDE</span><span class="c6 c163 c44">para uso do bot&atilde;o de emerg&ecirc;ncia com a interrup&ccedil;&atilde;o externa, no qual iremos fazer uso da interrup&ccedil;&atilde;o externa na borda de descida (transi&ccedil;&atilde;o do n&iacute;vel alto para baixo).</span></p><p class="c11 c14"><span class="c5"></span></p><p class="c1 c35"><span class="c6 c34 c163">Figura 12.5 &ndash;</span><span class="c6 c163 c44">Circuito de bot&atilde;o de emerg&ecirc;ncia com int. externa</span></p><a id="t.3c9232b2d5d9ea2a259f8403ad80b64e9db35916"></a><a id="t.139"></a><table class="c7"><tbody><tr class="c21"><td class="c215"><p class="c19"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 480.00px; height: 373.33px;"><img alt="" src="images/image4.png" style="width: 480.00px; height: 373.33px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td></tr></tbody></table><p class="c24"><span>      </span><span class="c42 c39 c50 c44">Fonte: Pr&oacute;prio autor (2021)</span></p><p class="c67 c35"><span class="c0">Na Figura 12.6 est&aacute; o diagrama do processo do uso da interrup&ccedil;&atilde;o externa associado a um bot&atilde;o de emerg&ecirc;ncia. Note que nesta figura existem dois in&iacute;cios de rotinas, sendo elas a principal e a de tratamento de interrup&ccedil;&otilde;es, onde elas s&atilde;o independentes.</span></p><p class="c67 c35 c14"><span class="c0"></span></p><p class="c1 c35"><span class="c6 c34 c163">Figura 12.6 &ndash;</span><span class="c0">Diagrama do processo do bot&atilde;o de emerg&ecirc;ncia com int. externa</span></p><a id="t.3c9232b2d5d9ea2a259f8403ad80b64e9db35916"></a><a id="t.140"></a><table class="c7"><tbody><tr class="c21"><td class="c218"><p class="c1"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 542.00px; height: 657.33px;"><img alt="" src="images/image67.png" style="width: 542.00px; height: 657.33px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td></tr></tbody></table><p class="c4"><span class="c6 c163 c44">  </span><span class="c60 c6 c39 c163 c44">Fonte: Pr&oacute;prio autor (2021)</span></p><p class="c11 c14"><span class="c5"></span></p><p class="c67 c35"><span class="c0">A rotina principal &eacute; executada ao ligar o PIC, e nela s&atilde;o feitas as seguintes a&ccedil;&otilde;es:</span></p><p class="c67 c35 c14"><span class="c0"></span></p><ol class="c80 lst-kix_gbuhtep1u1xd-0 start" start="1"><li class="c67 c35 c127 c173 li-bullet-0"><span class="c0">Faz-se as configura&ccedil;&otilde;es iniciais dos registradores de controle do PIC, como o INTCON, OPTION, PIE1, entre outros;</span></li></ol><p class="c67 c35 c127 c14"><span class="c0"></span></p><ol class="c80 lst-kix_gbuhtep1u1xd-0" start="2"><li class="c67 c35 c127 c173 li-bullet-0"><span class="c0">Ap&oacute;s isso caso o PIC inicie com o bot&atilde;o de emerg&ecirc;ncia pressionado (acontecer&aacute; quando se desliga o dispositivo com o bot&atilde;o de emerg&ecirc;ncia ligado, e ao religar o dispositivo, o bot&atilde;o encontra-se ligado) seta o bit/flag da interrup&ccedil;&atilde;o externa para que logo que proceda essa instru&ccedil;&atilde;o, chame a rotina de interrup&ccedil;&otilde;es. Caso o bot&atilde;o n&atilde;o esteja pressionado, segue o fluxo normal da rotina principal;</span></li></ol><p class="c67 c35 c14 c127"><span class="c0"></span></p><ol class="c80 lst-kix_gbuhtep1u1xd-0" start="3"><li class="c67 c35 c127 c173 li-bullet-0"><span class="c0">Nesse passo h&aacute; o teste para ver se o LED verde est&aacute; aceso (ligado), e caso esteja continua esse teste indefinidamente. Por&eacute;m, caso o LED esteja apagado (desligado), acende (liga) o LED verde e volta ao teste de verifica&ccedil;&atilde;o do estado (aceso ou apagado).</span></li></ol><p class="c67 c35 c14"><span class="c0"></span></p><p class="c67 c35"><span class="c6 c163 c44">A rotina principal &eacute; pequena e a fun&ccedil;&atilde;o dela &eacute; fazer as configura&ccedil;&otilde;es iniciais e manter o LED verde aceso enquanto estiver o processamento sobre ela.</span></p><p class="c11 c14"><span class="c5"></span></p><p class="c67 c35"><span class="c0">A rotina de tratamento das interrup&ccedil;&otilde;es a baseada nos seguintes passos:</span></p><p class="c67 c35 c14"><span class="c0"></span></p><ol class="c80 lst-kix_mp051k212w0m-0 start" start="1"><li class="c17 c173 li-bullet-0"><span class="c6 c163 c44">Salva o estado do registrador </span><span class="c47 c6 c34 c37">W</span><span class="c6 c163 c44">, pois ele poderia estar sendo usado para algum processo aritm&eacute;tico ou l&oacute;gico no momento da chamada da interrup&ccedil;&atilde;o e isso &eacute; importante ter essa informa&ccedil;&atilde;o para que quando voltar para a rotina principal, seus dados estejam &iacute;ntegros, e essa informa&ccedil;&atilde;o &eacute; dada pela pr&oacute;pria documenta&ccedil;&atilde;o da Microchip em </span><span class="c6 c39 c163 c44">DATASHEET PIC16F628A</span><span class="c0">na se&ccedil;&atilde;o 14.6 - Context Saving During Interrupts, na p&aacute;gina 111.</span></li></ol><p class="c17 c14"><span class="c0"></span></p><ol class="c80 lst-kix_mp051k212w0m-0" start="2"><li class="c17 c173 li-bullet-0"><span class="c6 c163 c44">Salva o estado do registrador </span><span class="c47 c6 c34 c37">STATUS</span><span class="c0">, conforme explicado no item 1 acima;</span></li></ol><p class="c17 c14"><span class="c0"></span></p><ol class="c80 lst-kix_mp051k212w0m-0" start="3"><li class="c17 c173 li-bullet-0"><span class="c6 c163 c44">Neste passo queremos fazer o tratamento da interrup&ccedil;&atilde;o externa, e como o endere&ccedil;o <span class="definesASM1">0x04</span><span class="c0">&eacute; o endere&ccedil;o de tratamento de todas as interrup&ccedil;&otilde;es, devemos verificar que a interrup&ccedil;&atilde;o que vamos tratar no primeiro momento &eacute; a interrup&ccedil;&atilde;o externa e para isso temos que fazer essa verifica&ccedil;&atilde;o, e caso seja a interrup&ccedil;&atilde;o externa o processo pula para o passo 4, enquanto que for outra interrup&ccedil;&atilde;o, pula para o passo 9;</span></li></ol><p class="c17 c14"><span class="c0"></span></p><ol class="c80 lst-kix_mp051k212w0m-0" start="4"><li class="c17 c173 li-bullet-0"><span class="c6 c163 c44">Como vamos tratar a interrup&ccedil;&atilde;o externa, primeiramente limpamos o flag <span class="c47 c6 c34">INTF</span><span class="c0">(flag de estado da interrup&ccedil;&atilde;o externa), pois caso deixemos limpo, voltaremos aqui pois eles ainda estar&aacute; setado;</span></li></ol><p class="c17 c14"><span class="c0"></span></p><ol class="c80 lst-kix_mp051k212w0m-0" start="5"><li class="c17 c173 li-bullet-0"><span class="c0">Desligamos o LED verde, pois estamos em &ldquo;estado de emerg&ecirc;ncia&quot;;</span></li></ol><p class="c17 c14"><span class="c0"></span></p><ol class="c80 lst-kix_mp051k212w0m-0" start="6"><li class="c17 c173 li-bullet-0"><span class="c0">Ligamos o LED vermelho para fazer o tratamento da &quot;emerg&ecirc;ncia&quot;;</span></li></ol><p class="c17 c14"><span class="c0"></span></p><ol class="c80 lst-kix_mp051k212w0m-0" start="7"><li class="c17 c173 li-bullet-0"><span class="c0">Neste passo h&aacute; a verifica&ccedil;&atilde;o se o bot&atilde;o continua pressionado, caso verdadeiro, fica neste passo at&eacute; o bot&atilde;o n&atilde;o estiver mais pressionado. Por&eacute;m, se o bot&atilde;o n&atilde;o estiver mais pressionado, iremos para o passo 8;</span></li></ol><p class="c17 c14"><span class="c0"></span></p><ol class="c80 lst-kix_mp051k212w0m-0" start="8"><li class="c17 c173 li-bullet-0"><span class="c0">Neste passo desligamos o LED vermelho e seguimos para o passo seguinte;</span></li></ol><p class="c14 c17"><span class="c0"></span></p><ol class="c80 lst-kix_mp051k212w0m-0" start="9"><li class="c17 c173 li-bullet-0"><span class="c0">Neste passo restauramos o estado do registrador W armazenado no passo 1;</span></li></ol><p class="c17 c14"><span class="c0"></span></p><ol class="c80 lst-kix_mp051k212w0m-0" start="10"><li class="c17 c173 li-bullet-0"><span class="c0">Aqui restauramos o estado do registrador STATUS armazenado no passo 2;</span></li></ol><p class="c17 c14"><span class="c0"></span></p><ol class="c80 lst-kix_mp051k212w0m-0" start="11"><li class="c17 c173 li-bullet-0"><span class="c0">E por &uacute;ltimo sa&iacute;mos da rotina das interrup&ccedil;&otilde;es.</span></li></ol><p class="c67 c35 c14"><span class="c0"></span></p><p class="c67 c35"><span class="c0">O c&oacute;digo associado a Figura 12.5 e Figura 12.6 &eacute; o C&oacute;digo 12.1 no qual relaciona os comportamentos de todos os componentes com uso no microcontrolador PIC16F628A.</span></p><p class="c67 c35 c14"><span class="c0"></span></p><p class="c1 c35"><span class="c6 c34 c163">C&oacute;digo 12.1 &ndash;</span><span class="c0">C&oacute;digo do exemplo de bot&atilde;o de emerg&ecirc;ncia com a int. externa</span></p><a id="t.7e113bfdd864531169e6774d2122f28c470abcaa"></a><a id="t.141"></a><table class="c210"><tbody><tr class="c21"><td class="c122"><p class="c4"><span class="c16 c8">1  #INCLUDE &lt;P16F628A.INC&gt;</span></p><p class="c4"><span class="c16 c8">2  LIST P=16F628A</span></p><p class="c4"><span class="c16 c8">3  __CONFIG _BODEN_ON &amp; _MCLRE_ON &amp; _LVP_OFF &amp; _WDT_OFF &amp; INTOSC &amp; _CP_OFF &amp; _PWRTE_ON</span></p><p class="c4"><span class="c16 c8">4  </span></p><p class="c4"><span class="c16 c8">5  #DEFINE W_TEMP   0x20</span></p><p class="c4"><span class="c16 c8">6  #DEFINE STATUS_TEMP 0x21</span></p><p class="c4"><span class="c16 c8">7  #DEFINE BOTAO    PORTB, RB0</span></p><p class="c4"><span class="c16 c8">8  #DEFINE LED_GREEN  PORTA, RA0</span></p><p class="c4"><span class="c16 c8">9  #DEFINE LED_RED   PORTA, RA1</span></p><p class="c4"><span class="c16 c8">10</span></p><p class="c4"><span class="c16 c8">11  ORG   0x00</span></p><p class="c4"><span class="c16 c8">12  GOTO  INICIAPARAMETROS</span></p><p class="c4"><span class="c16 c8">13  </span></p><p class="c4"><span class="c16 c8">14  ORG   0x04</span></p><p class="c4"><span class="c16 c8">15  MOVWF  W_TEMP</span></p><p class="c4"><span class="c16 c8">16  SWAPF  STATUS, 0</span></p><p class="c4"><span class="c16 c8">17  MOVWF  STATUS_TEMP</span></p><p class="c4"><span class="c16 c8">18  </span></p><p class="c4"><span class="c16 c8">19  BTFSS  INTCON, INTF</span></p><p class="c4"><span class="c16 c8">20  GOTO  SAIDA_INTERRUPCAO</span></p><p class="c4"><span class="c16 c8">21  BCF   INTCON, INTF</span></p><p class="c4"><span class="c16 c8">22  BCF   LED_GREEN</span></p><p class="c4"><span class="c16 c8">23  BSF   LED_RED</span></p><p class="c4"><span class="c16 c8">24  BTFSS  BOTAO</span></p><p class="c4"><span class="c16 c8">25  GOTO  $-1</span></p><p class="c4"><span class="c16 c8">26  BCF   LED_RED</span></p><p class="c4"><span class="c16 c8">27  </span></p><p class="c4"><span class="c16 c8"> SAIDA_INTERRUPCAO:</span></p><p class="c4"><span class="c16 c8">29  SWAPF  STATUS_TEMP, 0</span></p><p class="c4"><span class="c16 c8">30  MOVWF  STATUS</span></p><p class="c4"><span class="c16 c8">31  MOVF  W_TEMP, 0</span></p><p class="c4"><span class="c16 c8">32  RETFIE  </span></p></td><td class="c237"><p class="c67 c35"><span class="c16 c8">33    </span></p><p class="c67 c35"><span class="c16 c8"> INICIAPARAMETROS:</span></p><p class="c67 c35"><span class="c16 c8">35  BCF   STATUS, RP1</span></p><p class="c67 c35"><span class="c16 c8">36  BSF   STATUS, RP0</span></p><p class="c67 c35"><span class="c16 c8">37  </span></p><p class="c67 c35"><span class="c16 c8">38  MOVLW  B&#39;11000000&#39;</span></p><p class="c67 c35"><span class="c16 c8">39  MOVWF  OPTION_REG</span></p><p class="c67 c35"><span class="c16 c8">40  </span></p><p class="c67 c35"><span class="c16 c8">41  CLRF  PIE1</span></p><p class="c67 c35"><span class="c16 c8">42  </span></p><p class="c67 c35"><span class="c16 c8">43  MOVLW  B&#39;11111100&#39;</span></p><p class="c67 c35"><span class="c16 c8">44  MOVWF  TRISA</span></p><p class="c67 c35"><span class="c16 c8">45  </span></p><p class="c67 c35"><span class="c16 c8">46  MOVLW  B&#39;11111111&#39;</span></p><p class="c67 c35"><span class="c16 c8">47  MOVWF  TRISB</span></p><p class="c67 c35"><span class="c16 c8">48  </span></p><p class="c67 c35"><span class="c16 c8">49  BCF   STATUS, RP1</span></p><p class="c67 c35"><span class="c16 c8">50  BCF   STATUS, RP0</span></p><p class="c67 c35"><span class="c16 c8">51  </span></p><p class="c67 c35"><span class="c16 c8">52  MOVLW  B&#39;00000111&#39;</span></p><p class="c67 c35"><span class="c16 c8">53  MOVWF  CMCON</span></p><p class="c67 c35"><span class="c16 c8">54  </span></p><p class="c67 c35"><span class="c16 c8">55  MOVLW  B&#39;10010000&#39;</span></p><p class="c67 c35"><span class="c16 c8">56  MOVWF  INTCON</span></p><p class="c67 c35"><span class="c16 c8">57  </span></p><p class="c67 c35"><span class="c16 c8"> PROGRAMAPRINCIPAL:</span></p><p class="c67 c35"><span class="c16 c8">58  BTFSS  LED_GREEN</span></p><p class="c67 c35"><span class="c16 c8">60  BSF   LED_GREEN</span></p><p class="c67 c35"><span class="c16 c8">61  GOTO  PROGRAMAPRINCIPAL</span></p><p class="c67 c35"><span class="c16 c8">62  </span></p><p class="c67 c35"><span class="c16 c8">63  END</span></p></td></tr></tbody></table><p class="c67 c35 c14"><span class="c5"></span></p><p class="c67 c35"><span class="c6 c163 c44">No C&oacute;digo 12.1 nas linhas 5 e 6 foram definidas duas vari&aacute;veis nos endere&ccedil;os de mem&oacute;ria de uso geral (</span><span class="definesASM1">0x20</span><span class="c6 c163 c44">e <span class="definesASM1">0x21</span><span class="c0">), enquanto nas linhas 7 a 9 est&atilde;o definidas tr&ecirc;s vari&aacute;veis associadas aos pinos que relacionam o bot&atilde;o e os dois LEDs.</span></p><p class="c67 c35 c14"><span class="c0"></span></p><p class="c67 c35"><span class="c6 c44 c163">Nas linhas de 14 a 32 est&atilde;o as linhas de instru&ccedil;&atilde;o sobre a rotina de interrup&ccedil;&atilde;o. A linha 14 &eacute; a linha do in&iacute;cio da tratativa das interrup&ccedil;&otilde;es, enquanto que as linhas 15 a 17 est&atilde;o as instru&ccedil;&otilde;es para armazenamento dos estados dos registradores <span class="c47 c6 c34">W</span><span class="c6 c163 c44">e <span class="c47 c6 c34">STATUS</span><span class="c6 c163 c44">. J&aacute; na linha 19 est&aacute; a instru&ccedil;&atilde;o que avalia se a interrup&ccedil;&atilde;o que ocorreu &eacute; da interrup&ccedil;&atilde;o externa, e nas linhas 21, 22 e 26 est&atilde;o, respectivamente, a instru&ccedil;&atilde;o de limpeza do flag <span class="c47 c6 c34">INTF</span><span class="c6 c163 c44">do registrador <span class="c47 c6 c34">INTCON</span><span class="c0">(pois no momento j&aacute; est&aacute; sendo feita a tratativa dessa interrup&ccedil;&atilde;o), a instru&ccedil;&atilde;o para apagar/desligar o LED verde e a instru&ccedil;&atilde;o para apagar/desligar o LED vermelho. Na linha 23 tem a instru&ccedil;&atilde;o que acende/liga o LED vermelho.</span></p><p class="c67 c35 c14"><span class="c0"></span></p><p class="c67 c35"><span class="c6 c163 c44">Na linha 24 tem a instru&ccedil;&atilde;o para avaliar se o bot&atilde;o de emerg&ecirc;ncia continua pressionado (se ainda est&aacute; com n&iacute;vel baixo o pino <span class="c47 c6 c34">RB0</span><span class="c6 c163 c44">), e caso ainda esteja em n&iacute;vel baixo, o processo continua na linha 25 a qual tem a instru&ccedil;&atilde;o <span class="c47 c6 c34">GOTO</span><span class="definesASM1">$-1</span><span class="c6 c163 c44">, que representa o processo tem que saltar para o endere&ccedil;o atual de execu&ccedil;&atilde;o menos uma unidade, isto &eacute;, retorna para a instru&ccedil;&atilde;o anterior a instru&ccedil;&atilde;o atual, fazendo que o teste se repita at&eacute; que o bot&atilde;o n&atilde;o esteja mais pressionado e com isso saia do processo de repeti&ccedil;&atilde;o (</span><span class="c6 c163 c37 c44">loop</span><span class="c0">).</span></p><p class="c67 c35 c14"><span class="c0"></span></p><p class="c67 c35"><span class="c6 c163 c44">Por &uacute;ltimo, na rotina de interrup&ccedil;&otilde;es, h&aacute; a tratativa de restaura&ccedil;&atilde;o dos registradores <span class="c47 c6 c34">W</span><span class="c6 c163 c44">e <span class="c47 c6 c34">STATUS</span><span class="c0">, que est&atilde;o nas linhas 28 a 32.</span></p><p class="c67 c35 c14"><span class="c0"></span></p><p class="c67 c35"><span class="c0">Agora na rotina principal, que est&aacute; nas linhas 34 a 63, tem-se as sele&ccedil;&otilde;es de bancos de mem&oacute;ria nas linhas 35 e 36 (sele&ccedil;&atilde;o do banco de mem&oacute;ria 1) e linhas 49 e 50 (sele&ccedil;&atilde;o do banco de mem&oacute;ria 0).</span></p><p class="c67 c35 c14"><span class="c0"></span></p><p class="c67 c35"><span class="c6 c163 c44">Neste exemplo de aplica&ccedil;&atilde;o da interrup&ccedil;&atilde;o externa, as linhas de maior relev&acirc;ncia s&atilde;o as linhas 55 e 56 onde se tem a ativa&ccedil;&atilde;o da chave geral das interrup&ccedil;&otilde;es (bit <span class="c47 c6 c34">GIE</span><span class="c6 c163 c44">- 8&ordm; bit do registrador <span class="c47 c6 c34">INTCON</span><span class="c6 c163 c44">) como tamb&eacute;m o bit de ativa&ccedil;&atilde;o da interrup&ccedil;&atilde;o externa (bit <span class="c47 c6 c34">INTE</span><span class="c6 c163 c44">- 5&ordm; bit do registrador <span class="c47 c6 c34">INTCON</span><span class="c0">).</span></p><p class="c67 c35 c14"><span class="c0"></span></p><p class="c67 c35"><span class="c0">Nas linhas de 38 a 53, est&atilde;o linhas padr&otilde;es estudadas em epis&oacute;dios anteriores, no qual daremos &ecirc;nfase nas linhas 59 a 61, respons&aacute;veis pelo controle sobre o LED verde.</span></p><p class="c67 c35 c14"><span class="c0"></span></p><p class="c67 c35"><span class="c0">Na linha 59 tem-se a instru&ccedil;&atilde;o de teste se o LED verde est&aacute; aceso/ligado, se estiver, salta a instru&ccedil;&atilde;o da linha 60 que &eacute; a instru&ccedil;&atilde;o para acender/ligar o LED verde. J&aacute; na linha 61 tem a instru&ccedil;&atilde;o para levar ao in&iacute;cio do processo novamente</span></p><p class="c67 c35 c14"><span class="c0"></span></p><p class="c67 c35 c14"><span class="c0"></span></p><hr style="page-break-before:always;display:none;">