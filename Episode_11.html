<h1 class="c75 c35" id="h.71w1j1gtar3c"><span class="c28 c87"></span></h1><h1 class="c95 c35" id="h.bscpoad04ftu"><span class="c28 c87">Epis&oacute;dio 11: Criando e chamando subrotinas com CALL, RETURN e RETLW no PIC16F628A</span></h1><p class="c11">Como visto no epis&oacute;dio 10, escrevemos o C&oacute;digo 10.5 de cria&ccedil;&atilde;o de delay (esperar um per&iacute;odo de tempo) e dependendo da aplica&ccedil;&atilde;o, muitos c&oacute;digos podem ser repetidos v&aacute;rias vezes e a&iacute; entra a necessidade de cria&ccedil;&atilde;o de subrotinas como forma de facilitar o desenvolvimento do c&oacute;digo como um todo</p><p class="c11">Como a necessidade de uso repetitivo de fragmentos de c&oacute;digo, uma rotina que &eacute; utilizada em algumas partes do c&oacute;digo &eacute; chamada de subrotina ao fragmento de c&oacute;digo que pode ser chamado v&aacute;rias vezes, no qual se escreve ela apenas uma vez</p><p class="c11">Tomando como exemplo o C&oacute;digo 10.5 para escrever o C&oacute;digo 11.1 a partir da regra que pe&ccedil;a que ele se repita no seguinte padr&atilde;o: esperar 1 segundo e ligar o LED, esperar 500 milissegundos e desligar o LED, esperar 500 milissegundos e ligar o LED, esperar 1 segundo e desligar o LED.</p><p class="c12"><span class="c34">C&oacute;digo 11.1 -</span>Exemplo de uso de subrotinas</span></p><a id="t.ae297f67ac1cee5bbc74199bbadd88da85dd74e7"></a><a id="t.133"></a><table class="c56"><tbody><tr class="c21"><td class="c68"><p class="c11 c14"><span class="c2"></span></p><p class="c19"><span class="c13 c8">; DESENVOLVIDO POR EVERTON P. CRUZ</span></p><p class="c19"><span class="c8"> </span><span class="c13 c8">; COM O PROPOSITO DE USO BASE PARA OS EPISODIOS</span></p><p class="c19"><span class="c8"> </span><span class="c13 c8">; DA SERIE CONHECENDO O MICROCONTROLADOR PIC16F628A</span></p><p class="c19"><span class="c8"> </span><span class="c8 c20">#INCLUDE</span><span class="c8"></span><span class="c42 c8 c181">&lt;P16F628A.INC&gt;</span></p><p class="c19"><span class="c8"> </span><span class="c8 c20">LIST</span><span class="c8"></span><span class="c8 c18">P</span><span class="c8">=</span><span class="c42 c8 c18">16F628A</span></p><p class="c19"><span class="c8"> </span><span class="c8 c20">__CONFIG</span><span class="c8"></span><span class="c8 c18">_BOREN_ON</span><span class="c8">&amp; </span><span class="c8 c18">_CP_OFF</span><span class="c8">&amp; </span><span class="c8 c18">_PWRTE_ON</span><span class="c8">&amp; </span><span class="c8 c18">_WDT_OFF</span><span class="c8">&amp; </span><span class="c8 c18">_LVP_OFF</span><span class="c8">&amp; </span><span class="c8 c18">_MCLRE_OFF</span><span class="c8">&amp; </span><span class="c42 c8 c18">_INTRC_OSC_NOCLKOUT</span></p><p class="c19"><span class="c2"></span></p><p class="c19"><span class="c8"> </span><span class="c13 c8">; DEFINICAO DE VARIAVEIS</span></p><p class="c19"><span class="c8"> </span><span class="c8 c20">#DEFINE</span><span class="c8"></span><span class="c8 c18">N1</span><span class="c8"> 0x20    </span><span class="c13 c8">; VARIAVEL DE TEMPO N1</span></p><p class="c19"><span class="c8"> </span><span class="c8 c20">#DEFINE</span><span class="c8"></span><span class="c8 c18">N2</span><span class="c8"> 0x21    </span><span class="c13 c8">; VARIAVEL DE TEMPO N2</span></p><p class="c19"><span class="c8"> </span><span class="c8 c20">#DEFINE</span><span class="c8"></span><span class="c8 c18">N3</span><span class="c8"> 0x22    </span><span class="c13 c8">; VARIAVEL DE TEMPO N3</span></p><p class="c19 c14"><span class="c2"></span></p><p class="c19"><span class="c8"> </span><span class="c38 c44">#DEFINE</span><span class="c8"></span><span class="c8 c18">LED</span><span class="c8">PORTA, RA0 </span><span class="c8 c115">; PINO DO LED</span><span class="c2"> </span></p><p class="c19 c14"><span class="c2"></span></p><p class="c19"><span class="c8"> </span><span class="c8 c20">ORG</span><span class="c8">  0x00    </span><span class="c13 c8">; TRATAMENTO DO RESET</span></p><p class="c19"><span class="c8"> </span><span class="c38 c34">GOTO</span><span class="c8">  </span><span class="c42 c8 c18">SETUP_PROCESSO</span></p><p class="c19 c14"><span class="c2"></span></p><p class="c19"><span class="c8"> </span><span class="c8 c20">ORG</span><span class="c8">  0x04    </span><span class="c13 c8">; TRATAMENTO DAS INTERRUPCOES</span></p><p class="c19"><span class="c8"> </span><span class="c42 c38 c34">RETFIE</span></p><p class="c19"><span class="c2">  </span></p><p class="c19"><span class="c2">SETUP_PROCESSO:</span></p><p class="c19"><span class="c8"> </span><span class="c13 c8">; SELECIONA O BANCO 1 DE MEMORIA</span></p><p class="c19"><span class="c8"> </span><span class="c38 c34">BCF</span><span class="c2"> STATUS, RP1</span></p><p class="c19"><span class="c8"> </span><span class="c38 c34">BSF</span><span class="c2"> STATUS, RP0</span></p><p class="c19 c14"><span class="c2"></span></p><p class="c19"><span class="c8"> </span><span class="c38 c34">BSF</span><span class="c8">PCON, OSCF </span><span class="c13 c8">; CONF. FREQ&Uuml;&Ecirc;NCIA DO OSCILADOR INTERNO EM 4 MHz</span></p><p class="c19"><span class="c2"> </span></p><p class="c19"><span class="c8"> </span><span class="c13 c8">; CONFIGURACOES DO REGISTRADOR OPTION</span></p><p class="c19"><span class="c8"> </span><span class="c38 c34">MOVLW</span><span class="c2">B&#39;10000000&#39;</span></p><p class="c19"><span class="c8"> </span><span class="c38 c34">MOVWF</span><span class="c2">OPTION_REG</span></p><p class="c19"><span class="c2">  </span></p><p class="c19"><span class="c8"> </span><span class="c13 c8">; MODIFICA O COMPORTAMENTO DO PORTA</span></p><p class="c19"><span class="c8"> </span><span class="c38 c34">MOVLW</span><span class="c2">B&#39;11111110&#39;</span></p><p class="c19"><span class="c8"> </span><span class="c38 c34">MOVWF</span><span class="c8">TRISA</span></p><p class="c19"><span class="c2">  </span></p><p class="c19"><span class="c8"> </span><span class="c13 c8">; MODIFICA O COMPORTAMENTO DO PORTB</span></p><p class="c19"><span class="c8"> </span><span class="c38 c34">MOVLW</span><span class="c8">B&#39;11111111&#39;</span></p><p class="c19"><span class="c8"> </span><span class="c38 c34">MOVWF</span><span class="c2">TRISB</span></p><p class="c19"><span class="c2">  </span></p><p class="c19"><span class="c8"> </span><span class="c13 c8">; SELECIONA O BANCO 0 DE MEMORIA</span></p><p class="c19"><span class="c8"> </span><span class="c38 c34">BCF</span><span class="c2"> STATUS, RP1</span></p><p class="c19"><span class="c8"> </span><span class="c38 c34">BCF</span><span class="c2"> STATUS, RP0  </span></p><p class="c19"><span class="c2">  </span></p><p class="c19"><span class="c8"> </span><span class="c13 c8">; DEFINE O MODO DE OPERACAO DO COMP. ANALOG. DESLIGADOS</span></p><p class="c19"><span class="c8"> </span><span class="c38 c34">MOVLW</span><span class="c2">B&#39;00000111&#39;</span></p><p class="c19"><span class="c8"> </span><span class="c38 c34">MOVWF</span><span class="c2">CMCON  </span></p><p class="c19"><span class="c2">  </span></p><p class="c19"><span class="c8"> </span><span class="c13 c8">; CONFIGURACOES DE INTERRUPCOES</span></p><p class="c19"><span class="c8"> </span><span class="c38 c34">MOVLW</span><span class="c2">B&#39;00000000&#39;</span></p><p class="c19"><span class="c8"> </span><span class="c38 c34">MOVWF</span><span class="c8">INTCON</span></p><p class="c19"><span class="c2"> </span></p><p class="c19"><span class="c2">PRINCIPAL:</span></p><p class="c19"><span class="c8"> </span><span class="c38 c34">CALL</span><span class="c8">  DELAY_1SEGUNDO    </span><span class="c8 c115">; CHAMA SUBROTINA</span></p><p class="c11"><span class="c8"> </span><span class="c38 c34">BSF</span><span class="c8">  LED          </span><span class="c8 c115">; LIGA LED</span></p><p class="c11"><span class="c8"> </span><span class="c38 c34">CALL</span><span class="c8">  DELAY_500MILISEGUNDOS </span><span class="c8 c115">; CHAMA SUBROTINA</span></p><p class="c11"><span class="c8"> </span><span class="c38 c34">BCF</span><span class="c8">  LED          </span><span class="c8 c115">; DESLIGA LED</span></p><p class="c11"><span class="c2"> </span></p><p class="c19"><span class="c8"> </span><span class="c38 c34">CALL</span><span class="c8">  DELAY_500MILISEGUNDOS </span><span class="c8 c115">; CHAMA SUBROTINA</span></p><p class="c11"><span class="c8"> </span><span class="c38 c34">BSF</span><span class="c8">  LED          </span><span class="c8 c115">; LIGA LED</span></p><p class="c11"><span class="c8"> </span><span class="c38 c34">CALL</span><span class="c8">  DELAY_1SEGUNDO    </span><span class="c8 c115">; CHAMA SUBROTINA</span></p><p class="c11"><span class="c8"> </span><span class="c38 c34">BCF</span><span class="c8">  LED          </span><span class="c8 c115">; DESLIGA LED</span></p><p class="c11 c14"><span class="c2"></span></p><p class="c19"><span class="c8"> </span><span class="c38 c34">GOTO</span><span class="c8"></span><span class="c42 c8 c18">PRINCIPAL</span></p><p class="c19 c14"><span class="c2"></span></p><p class="c19"><span class="c8 c115">; DELAY DE 1 SEGUNDO</span></p><p class="c19"><span class="c2">DELAY_1SEGUNDO:</span></p><p class="c11"><span class="c8"> </span><span class="c9">MOVLW</span><span class="c8"> </span><span class="c8 c54">.</span><span class="c8 c54 c179">10</span><span class="c8"> </span><span class="c13 c8">; VALOR PARA N1</span></p><p class="c11"><span class="c8"> </span><span class="c9">MOVWF</span><span class="c8"> </span><span class="c42 c8 c18">N1</span></p><p class="c11"><span class="c8"> </span><span class="c9">MOVLW</span><span class="c8"> </span><span class="c8 c54">.</span><span class="c8 c54 c179">10</span><span class="c8"> </span><span class="c13 c8">; VALOR PARA N2</span></p><p class="c11"><span class="c8"> </span><span class="c9">MOVWF</span><span class="c8"> </span><span class="c42 c8 c18">N2</span></p><p class="c11"><span class="c8"> </span><span class="c9">MOVLW</span><span class="c8"> </span><span class="c8 c54">.</span><span class="c8 c54 c179">10</span><span class="c8"> </span><span class="c13 c8">; VALOR PARA N3</span></p><p class="c11"><span class="c8"> </span><span class="c9">MOVWF</span><span class="c8"> </span><span class="c42 c8 c18">N3</span></p><p class="c11"><span class="c8">loop1:</span></p><p class="c11"><span class="c8"> </span><span class="c9">DECFSZ</span><span class="c8"> </span><span class="c8 c18 c42">N1</span></p><p class="c11"><span class="c8"> </span><span class="c9">GOTO</span><span class="c8">  loop1</span></p><p class="c11"><span class="c8"> </span><span class="c9">DECFSZ</span><span class="c8"> </span><span class="c8 c18">N2</span></p><p class="c11"><span class="c8"> </span><span class="c9">GOTO</span><span class="c8">  loop1</span></p><p class="c11"><span class="c8"> </span><span class="c9">DECFSZ</span><span class="c8"> </span><span class="c8 c18">N3</span></p><p class="c11"><span class="c8"> </span><span class="c9">GOTO</span><span class="c2">  loop1</span></p><p class="c11"><span class="c8"> </span><span class="c42 c38 c34">RETURN</span></p><p class="c11 c14"><span class="c2"></span></p><p class="c11"><span class="c8 c115">; DELAY DE 0.5 SEGUNDO = 500 MILISEGUNDOS</span></p><p class="c11"><span class="c2">DELAY_500MILISEGUNDOS:</span></p><p class="c11"><span class="c8"> </span><span class="c9">MOVLW</span><span class="c8"> </span><span class="c8 c54">.</span><span class="c8 c54 c179">10</span><span class="c8"> </span><span class="c13 c8">; VALOR PARA N1</span></p><p class="c11"><span class="c8"> </span><span class="c9">MOVWF</span><span class="c8"> </span><span class="c42 c8 c18">N1</span></p><p class="c11"><span class="c8"> </span><span class="c9">MOVLW</span><span class="c8"> </span><span class="c8 c54">.</span><span class="c8 c54 c179">10</span><span class="c8"> </span><span class="c13 c8">; VALOR PARA N2</span></p><p class="c11"><span class="c8"> </span><span class="c9">MOVWF</span><span class="c8"> </span><span class="c42 c8 c18">N2</span></p><p class="c11"><span class="c8"> </span><span class="c9">MOVLW</span><span class="c8"> </span><span class="c8 c54">.</span><span class="c8 c54 c179">10</span><span class="c8"> </span><span class="c13 c8">; VALOR PARA N3</span></p><p class="c11"><span class="c8"> </span><span class="c9">MOVWF</span><span class="c8"> </span><span class="c42 c8 c18">N3</span></p><p class="c11"><span class="c8">loop2:</span></p><p class="c11"><span class="c8"> </span><span class="c9">DECFSZ</span><span class="c8"> </span><span class="c42 c8 c18">N1</span></p><p class="c11"><span class="c8"> </span><span class="c9">GOTO</span><span class="c8">  loop2</span></p><p class="c11"><span class="c8"> </span><span class="c9">DECFSZ</span><span class="c8"> </span><span class="c8 c18">N2</span></p><p class="c11"><span class="c8"> </span><span class="c9">GOTO</span><span class="c8">  loop2</span></p><p class="c11"><span class="c8"> </span><span class="c9">DECFSZ</span><span class="c8"> </span><span class="c8 c18">N3</span></p><p class="c11"><span class="c8"> </span><span class="c9">GOTO</span><span class="c2">  loop2</span></p><p class="c11"><span class="c8"> </span><span class="c42 c38 c34">RETURN</span></p><p class="c19"><span class="c2"> </span></p><p class="c19"><span class="c2"> END</span></p><p class="c19 c14"><span class="c2"></span></p></td></tr></tbody></table><p class="c11">Um ponto a deixar claro aqui &eacute; que as duas novas instru&ccedil;&otilde;es usadas, </span><span class="c3">CALL</span>e </span><span class="c3">RETURN</span>,</span>executam sobre 2 ciclos, sendo que a primeira, a instru&ccedil;&atilde;o </span><span class="c3">CALL</span>, &eacute; utilizada sempre que quiser chamar uma subrotina. J&aacute; a segunda instru&ccedil;&atilde;o, a instru&ccedil;&atilde;o </span><span class="c3">RETURN</span>&eacute; sempre utilizada para voltar &agrave; pr&oacute;xima instru&ccedil;&atilde;o depois da instru&ccedil;&atilde;o </span><span class="c3">CALL</span>. Existe tamb&eacute;m para uso no c&oacute;digo a instru&ccedil;&atilde;o </span><span class="c3">RETLW</span><span class="c47 c6 c34">k</span>, a qual retorna de uma subrotina, escrevendo o valor <span class="c47 c6 c34">k</span>no registrador <span class="c47 c6 c34">k</span>. A instru&ccedil;&atilde;o </span><span class="c3">RETLW</span>&eacute; interessante quando se quer criar subrotinas que retornam certos valores pr&eacute; definidos</p><p class="c11">Assim, para as subrotinas deve-se contabilizar 4 ciclos a mais por causa das instru&ccedil;&otilde;es </span><span class="c3">CALL</span>e </span><span class="c3">RETURN</span>que s&atilde;o obrigat&oacute;rias quando se quer trabalhar com chamadas e execu&ccedil;&atilde;o de subrotinas</p><p class="c11">A fun&ccedil;&atilde;o da instru&ccedil;&atilde;o CALL k &eacute; de chamar a subrotina de r&oacute;tulo/endere&ccedil;o k desejada enquanto que a instru&ccedil;&atilde;o RETURN &eacute; de retornar &agrave; rotina principal</p><p class="c11">A instru&ccedil;&atilde;o RETLW k tem a fun&ccedil;&atilde;o de retornar de uma subrotina atribuindo ao registrador W o valor literal k</p><p class="c11">Vejamos um exemplo de uso da instru&ccedil;&atilde;o RETLW:</span></p><p class="c11"><span class="c60 c6 c39 c34 c50">colocar aqui um exemplo de uso</span></p><p class="c11 c14"><span class="c5"></span></p><hr style="page-break-before:always;display:none;">